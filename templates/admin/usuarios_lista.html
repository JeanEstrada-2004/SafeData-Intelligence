{% extends "base.html" %}
{% block title %}Usuarios{% endblock %}
{% block header %}Usuarios{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <form class="row g-2" method="get">
    <div class="col-auto"><input type="text" class="form-control" name="q" placeholder="email" value="{{ q or '' }}"/></div>
    <div class="col-auto">
      <select name="role" class="form-select">
        <option value="">Rol</option>
        {% for r in ['Gerente','JefeOperaciones','Analista','EncargadoSipCop'] %}
        <option value="{{r}}" {% if role==r %}selected{% endif %}>{{r}}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-auto">
      <select name="active" class="form-select">
        <option value="">Estado</option>
        <option value="true" {% if active=='true' %}selected{% endif %}>Activo</option>
        <option value="false" {% if active=='false' %}selected{% endif %}>Inactivo</option>
      </select>
    </div>
    <div class="col-auto"><button class="btn btn-outline-secondary" type="submit">Filtrar</button></div>
  </form>
  <a class="btn btn-primary" href="/admin/users/new">Nuevo</a>
  </div>
<div class="card p-3">
  <div class="table-responsive">
    <table class="table table-striped align-middle">
      <thead><tr><th>Email</th><th>Nombre</th><th>Rol</th><th>Estado</th><th>Acciones</th></tr></thead>
      <tbody>
        {% for u in items %}
        <tr>
          <td>{{ u.email }}</td>
          <td>{{ u.full_name or '-' }}</td>
          <td><span class="badge bg-info">{{ u.role }}</span></td>
          <td>{% if u.is_active %}<span class="badge bg-success">Activo</span>{% else %}<span class="badge bg-secondary">Inactivo</span>{% endif %}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="/admin/users/{{u.id}}/edit">Editar</a>
            <form method="post" action="/admin/users/{{u.id}}/delete" class="d-inline" onsubmit="return confirm('Â¿Desactivar usuario?');">
              <button class="btn btn-sm btn-outline-danger">Desactivar</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
