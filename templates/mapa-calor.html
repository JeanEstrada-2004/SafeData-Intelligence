{% extends "base.html" %}

{% block title %}Mapa de Calor{% endblock %}
{% block header %}Mapa de Calor{% endblock %}

{% block content %}

<div class="row">
    <!-- Columna izquierda: filtros y leyenda -->
    <div class="col-12 col-xl-4">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light d-flex align-items-center">
                <i class="fa-solid fa-sliders me-2"></i>
                <span>Parámetros de Visualización</span>
            </div>
            <div class="card-body">
                <form id="form-mapa">
                    <!-- Zona -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Zona</label>
                        <select class="form-select" name="zona">
                            <option>Zona 1</option>
                            <option>Zona 2</option>
                            <option>Zona 3</option>
                            <option>Zona 4</option>
                            <option>Zona 5</option>
                            <option>Zona 6</option>
                            <option>Zona 7</option>
                            <option>Todo el distrito</option>
                        </select>
                    </div>

                    <!-- Franja horaria -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Franja Horaria</label>
                        <select class="form-select" name="horario">
                            <option>00:00 - 06:00</option>
                            <option>06:00 - 12:00</option>
                            <option>12:00 - 18:00</option>
                            <option>18:00 - 24:00</option>
                            <option>Todo el día</option>
                        </select>
                    </div>

                    <!-- Tipo de incidente -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Tipo de Incidente</label>
                        <input class="form-control" name="tipo" placeholder="Robo, violencia familiar, etc.">
                    </div>

                    <button type="button" id="btn-aplicar" class="btn btn-primary w-100">
                        <i class="fa-solid fa-fire-flame-curved me-2"></i>
                        Actualizar Mapa
                    </button>
                </form>
            </div>
        </div>

        <!-- Leyenda / explicación operativa -->
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light d-flex align-items-center">
                <i class="fa-solid fa-circle-info me-2"></i>
                <span>¿Qué estoy viendo?</span>
            </div>
            <div class="card-body small">
                <p class="mb-2">
                    El mapa de calor muestra <strong>concentración de incidentes</strong> en las zonas patrulladas.
                    Cuanto más intenso el color, mayor frecuencia de alertas/denuncias.
                </p>
                <ul class="mb-2">
                    <li><span class="badge bg-danger">Rojo</span> Zona crítica, requiere patrullaje inmediato.</li>
                    <li><span class="badge bg-warning text-dark">Amarillo</span> Zona bajo observación preventiva.</li>
                    <li><span class="badge bg-success">Verde</span> Zona estable / menor incidencia.</li>
                </ul>
                <p class="text-muted mb-0">
                    Esto se alimentará con datos históricos de denuncias y coordenadas reales
                    (por ejemplo, reportes de SipCop + patrullaje municipal).
                </p>
            </div>
        </div>

        <!-- Resumen de hotspots -->
        <div class="card shadow-sm">
            <div class="card-header bg-light d-flex align-items-center">
                <i class="fa-solid fa-ranking-star me-2"></i>
                <span>Puntos Calientes</span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-bordered align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width:40%">Sector / Zona</th>
                                <th style="width:30%">Nivel Riesgo</th>
                                <th>Observación</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="fw-semibold">Zona 1</td>
                                <td>
                                    <span class="badge bg-danger">ALTO</span>
                                </td>
                                <td class="small text-muted">Robos reiterados en área comercial nocturna</td>
                            </tr>
                            <tr>
                                <td class="fw-semibold">Zona 4</td>
                                <td>
                                    <span class="badge bg-warning text-dark">MEDIO</span>
                                </td>
                                <td class="small text-muted">Conflictos vecinales y riñas en la tarde</td>
                            </tr>
                            <tr>
                                <td class="fw-semibold">Zona 6</td>
                                <td>
                                    <span class="badge bg-success">BAJO</span>
                                </td>
                                <td class="small text-muted">Actividad principalmente logística / almacenes</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="small text-muted mt-2 mb-0">
                    Este resumen sirve para priorizar rondas y asignación de móviles.
                </p>
            </div>
        </div>
    </div>

    <!-- Columna derecha: mapa -->
    <div class="col-12 col-xl-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header bg-light d-flex align-items-center justify-content-between flex-wrap">
                <div class="d-flex align-items-center">
                    <i class="fa-solid fa-fire-flame-curved me-2"></i>
                    <span>Mapa de Calor de Incidentes</span>
                </div>
                <small class="text-muted">
                    Vista simulada
                </small>
            </div>
            <div class="card-body">
                <!-- Contenedor visual donde irá el mapa real (Leaflet / Mapbox / etc.) -->
                <div
                    id="mapa-calor-preview"
                    class="border rounded bg-light d-flex flex-column justify-content-center align-items-center text-muted"
                    style="width:100%; height:400px;"
                >
                    <div class="text-center">
                        <i class="fa-solid fa-map-location-dot fa-2x mb-3"></i>
                        <div class="fw-semibold">[Mapa de calor en construcción]</div>
                        <div class="small text-muted">Aquí se mostrará la densidad de denuncias por zona y hora seleccionada.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel de detalles debajo del mapa -->
        <div class="card shadow-sm">
            <div class="card-header bg-light d-flex align-items-center">
                <i class="fa-solid fa-list-check me-2"></i>
                <span>Detalle de la Selección Actual</span>
            </div>
            <div class="card-body small">
                <div id="detalle-seleccion">
                    <p class="mb-1"><strong>Zona:</strong> Zona 1</p>
                    <p class="mb-1"><strong>Franja horaria:</strong> 18:00 - 24:00</p>
                    <p class="mb-1"><strong>Tipo incidente:</strong> Robo con violencia</p>
                    <p class="mb-2"><strong>Estado:</strong> Alta concentración de reportes recientes</p>
                    <div class="alert alert-danger p-2">
                        <i class="fa-solid fa-triangle-exclamation me-2"></i>
                        Reforzar patrullaje nocturno y control de puntos ciegos.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Este script solo hace la parte visual de "Aplicar" para que parezca interactivo.
// No consulta backend todavía.
// Actualiza el bloque de detalle debajo del mapa usando los valores del formulario.

document.getElementById("btn-aplicar").addEventListener("click", () => {
    const form = document.getElementById("form-mapa");
    const zona = form.zona.value;
    const horario = form.horario.value;
    const tipo = form.tipo.value || "(cualquier tipo)";

    const detalleDiv = document.getElementById("detalle-seleccion");

    detalleDiv.innerHTML = `
        <p class="mb-1"><strong>Zona:</strong> ${zona}</p>
        <p class="mb-1"><strong>Franja horaria:</strong> ${horario}</p>
        <p class="mb-1"><strong>Tipo incidente:</strong> ${tipo}</p>
        <p class="mb-2"><strong>Estado:</strong> Información generada con datos históricos simulados</p>
        <div class="alert alert-warning p-2 mb-0">
            <i class="fa-solid fa-triangle-exclamation me-2"></i>
            Vista simulada: cuando integremos datos reales, este panel mostrará la intensidad
            de riesgo y la recomendación operativa de patrullaje.
        </div>
    `;

    // Podríamos también simular "colorear" el mapa, de forma falsa.
    const mapa = document.getElementById("mapa-calor-preview");
    mapa.style.background = "radial-gradient(circle at 50% 50%, rgba(255,0,0,0.35) 0%, rgba(255,165,0,0.2) 40%, rgba(255,255,0,0.05) 70%, rgba(0,0,0,0) 80%)";
});
</script>
{% endblock %}
